<script type="text/discourse-plugin" version="0.0.1">
const {
    iconNode
} = require("discourse-common/lib/icon-library")
let left = settings.icon_left
let right = settings.icon_right


api.registerConnectorClass('below-site-header', 'homepage-toggle', {

    setupComponent(args, component) {


        var topMenuRoutes = component.siteSettings.top_menu.split('|').map(function(route) {
            return '/' + route
        });

        // The first page listed in the 'top_menu' setting is your homepage
        // lets assign it to a variable
        var homeRoute = topMenuRoutes[0];

        // This calls our code whenever the page changes
        api.onPageChange((url) => {

            // Check if we're on the homepage 
            if (url === "/" || url === homeRoute) {
                api.decorateWidget('header-icons:before', helper => {
                    return helper.h('li', [
                        helper.h('label.homepage-toggle-switch', [
                            helper.h('input.homepage-toggle-checkbox', {
                                type: 'checkbox'
                            }),
                            helper.h("span.homepage-toggle-thumb", [
                                helper.h("i.tt-left", iconNode(right)),
                                helper.h("i.tt-right", iconNode(left))
                            ])
                        ])
                    ])
                })
            }
        })
    }
})



window.addEventListener("DOMContentLoaded", (event) => {
    document.querySelector(".homepage-toggle-checkbox").addEventListener("click", (event) => {
        let s = document.querySelector(".homepage-toggle-checkbox").checked
        if (s == true) {
            window.location.replace(settings.url_right)
        } else {
            window.location.replace(settings.url_left)
        }

    })
    if (window.location.href == settings.url_right) {
        document.querySelector(".homepage-toggle-checkbox").checked = true
    }
})

</script>